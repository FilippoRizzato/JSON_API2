<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Product Management</title>
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h2>Product Management</h2>
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createModal">Crea</button>
    <hr>
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Price</th>
                <th>Brand</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="productTable">
            <!-- Product data will be inserted here -->
        </tbody>
    </table>
</div>

<!-- Modal -->
<div class="modal fade" id="createModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Create New Product</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <div class="form-group">
                        <label for="productName">Product Name:</label>
                        <input type="text" class="form-control" id="productName" placeholder="Enter product name" required>
                    </div>
                    <div class="form-group">
                        <label for="productPrice">Product Price:</label>
                        <input type="number" class="form-control" id="productPrice" placeholder="Enter product price" required>
                    </div>
                    <div class="form-group">
                        <label for="productBrand">Product Brand:</label>
                        <input type="text" class="form-control" id="productBrand" placeholder="Enter product brand" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="submitForm()">Save changes</button>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
function submitForm() {
    var productName = document.getElementById('productName').value;
    var productPrice = document.getElementById('productPrice').value;
    var productBrand = document.getElementById('productBrand').value;

    var data = {
        data: {
            attributes: {
                nome: productName,
                prezzo: productPrice,
                marca: productBrand
            }
        }
    };

    fetch('/products', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        console.log('Product added:', result);
        fetchProducts(); // Aggiorna la tabella dei prodotti dopo l'inserimento
        $('#createModal').modal('hide'); // Chiudi il modal dopo l'inserimento
    })
    .catch(error => console.error('Error adding product:', error));
}

function fetchProducts() {
    fetch('/products')
    .then(response => response.json())
    .then(data => {
        var productTable = document.getElementById('productTable');
        productTable.innerHTML = '';

        data.data.forEach(product => {
            var row = document.createElement('tr');
            row.innerHTML = `
                <td>${product.id}</td>
                <td>${product.attributes.nome}</td>
                <td>${product.attributes.prezzo}</td>
                <td>${product.attributes.marca}</td>
                <td>
                    <button class="btn btn-danger" onclick="deleteProduct(${product.id})">Delete</button>
                    <button class="btn btn-primary" onclick="editProduct(${product.id})">Edit</button>
                </td>
            `;
            productTable.appendChild(row);
        });
    })
    .catch(error => console.error('Error fetching products:', error));
}

function deleteProduct(productId) {
    fetch(`/products/${productId}`, {
        method: 'DELETE'
    })
    .then(response => {
        if (response.status === 204) {
            console.log
            ('Product deleted successfully');
            fetchProducts();
        } else {
            throw new Error('Failed to delete product');
        }
    })
    .catch(error => console.error('Error deleting product:', error));
}

function editProduct(productId) {
    // Placeholder per la funzione di modifica del prodotto
    console.log('Edit product:', productId);
}

// Esegui il fetch dei prodotti quando la pagina viene caricata
fetchProducts();
</script>
</body>
</html>
